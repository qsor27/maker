image: centos:7

before_script:
  - yum -y install epel-release
  - yum -y install git make gcc mingw64-gcc mingw32-gcc zip
  - (cd /usr/local && curl -L -o - https://nodejs.org/dist/v10.14.2/node-v10.14.2-linux-x64.tar.gz | tar zxf - --strip-components=1)
  - (cd /usr/local && curl -L -o - https://dl.google.com/go/go1.11.4.linux-amd64.tar.gz | tar zxf -)

build:
  script: |
    export GOPATH=/go
    export PATH=$GOPATH/bin:/usr/local/go/bin:$PATH
    make install-deps
    GOOS=linux GOARCH=amd64 make dist
    CC=x86_64-w64-mingw32-gcc GOOS=windows GOARCH=amd64 make dist
    CC=i686-w64-mingw32-gcc GOOS=windows GOARCH=386 make dist
    cp dist/*.zip ${CI_PROJECT_DIR}

  artifacts:
    paths:
      - "*.zip"
